<html>

<head>
  <title>Clippy</title>
  <link rel="stylesheet" href="/stylesheets/style.css">

  <script>
    window.onload=function(){
      //CHANGE THIS ON AWS!!!!
      var hosturl = 'http://localhost:3000'
      document.getElementById("demo-house-submit").addEventListener("click", function () {

        var data = {
          "address": document.getElementById('demo-address').value,
          "city": document.getElementById('demo-city').value,
          "state": document.getElementById('demo-state').value,
          "zip": document.getElementById('demo-zip').value,
          "borrow": document.getElementById('demo-borrow').value,
          "owner_of_record": document.getElementById('demo-owner_of_record').value,
          "county": document.getElementById('demo-county').value
        }
        var data_json = JSON.stringify(data)

        fetch( hosturl + '/house', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: data_json
        }).then(response => {
          location.reload();
        })
      })

      document.getElementById("demo-getappraisals").addEventListener("click", function () {
        fetch( hosturl + '/list', {
          method: 'GET',
          headers: {
              'Content-Type': 'application/json',
          }
        }).then(response => response.json()).then((responseJson) => {
          var responseStr = JSON.stringify(responseJson)
          var regexStr = ''
          f = {
            brace: 0
          }
          regexStr = responseStr.replace(/({|}[,]*|[^{}:]+:[^{}:,]*[,{]*)/g, function (m, p1) {
            var makeHtmlFromJson = function() {
              return '<div style="text-indent: ' + (f['brace'] * 20) + 'px;">' + p1 + '</div>';
            }
            var returnStr = 0;
            if (p1.lastIndexOf('{') === (p1.length - 1)) {
              returnStr = makeHtmlFromJson();
              f['brace'] += 1;
            } else if (p1.indexOf('}') === 0) {
              f['brace'] -= 1;
              returnStr = makeHtmlFromJson();
            } else {
              returnStr = makeHtmlFromJson();
            }
            return rtnStr;
          });
          document.body.innerHTML += regexStr; // appends the result to the body of the HTML document
        })
      })
    }
  </script>
</head>

<body>
  <h1>Clippy</h1>
  <p>Looks like you are trying to reach an unfinished page. Would you like some help?</p>

  <h4>Demo House Form</h4>
  <form id="demo-house-form">
    Address <input id="demo-address" type="text"><br>
    City <input id="demo-city" type="text"><br>
    State <input id="demo-state" type="text"><br>
    Zip Code <input id="demo-zip" type="text"><br>
    Borrower <input id="demo-borrow" type="text"><br>
    Owner Of Public Record <input id="demo-owner_of_record" type="text"><br>
    County <input id="demo-county" type="text"></intput><br>

    <button id="demo-house-submit">submit</button>
  </form>
  <h5>Too add another record after listing all Appraisals, refresh the page</h5>
  <button id="demo-getappraisals">Get Appraisals</button><br>
</body>

</html>
